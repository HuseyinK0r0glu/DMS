services:
  postgres:
    image: postgres:15-alpine
    container_name: dms_postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: newpassword
      POSTGRES_DB: dms
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./migrations:/docker-entrypoint-initdb.d
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
  seaweedfs:
    image: chrislusf/seaweedfs:latest
    container_name: dms_seaweedfs
    ports:
      - "8333:8333"    # S3 API port
      - "8888:8888"    # Filer UI port
      - "9333:9333"    # Master server port
    volumes:
      - seaweedfs_data:/data
    command: >
      server
      -master.port=9333
      -master.defaultReplication=000
      -master.volumeSizeLimitMB=10000
      -volume.max=100
      -filer=true
      -filer.port=8888
      -s3=true
      -s3.port=8333
      -s3.iam=false
      -dir=/data
    healthcheck:
      test: ["CMD", "sh", "-c", "curl -f http://localhost:8333 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

volumes:
  postgres_data:
  seaweedfs_data:

